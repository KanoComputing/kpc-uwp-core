# Universal Windows Platform
# Build a Universal Windows Platform project using Visual Studio.
# Add steps that test and distribute an app, save build artifacts, and more:
# https://aka.ms/yaml


trigger:
  - master

pr:
  branches:
    include:
      - '*'

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'x86|x64'
  buildConfiguration: 'Release'
  appxPackageDir: '$(Build.ArtifactStagingDirectory)\AppxPackages\\'

steps:
  - task: NuGetToolInstaller@1
    displayName: 'Install NuGet client'

  - task: NuGetCommand@2
    displayName: 'Fetch project NuGet dependencies'
    inputs:
     restoreSolution: '$(solution)'

  - task: VSBuild@1
    displayName: 'Build with Visual Studio'
    inputs:
      platform: 'any cpu'
      solution: '$(solution)'
      configuration: '$(buildConfiguration)'
      msbuildArgs: '/p:AppxBundlePlatforms="$(buildPlatform)" /p:AppxPackageDir="$(appxPackageDir)" /p:AppxBundle=Always /p:UapAppxPackageBuildMode=CI'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish KpcUwpCore NuGet artifacts'
    inputs:
      PathtoPublish: '$(Build.SourcesDirectory)/KpcUwpCore/bin/$(buildConfiguration)/Package'
      ArtifactName: 'KpcUwpCore'
      publishLocation: 'Container'
